Got it — **in a web app on Replit**, the fix is a little different:

✅ You *can* open the SoundCloud login page in the browser
❌ But you generally **cannot call `api.soundcloud.com` directly from the browser** (CORS + security restrictions), and you **should not** put your `client_secret` in frontend code.

So the correct fix is:

> **Frontend opens SoundCloud OAuth (`soundcloud.com/connect`) → gets `code` → sends code to your Replit backend → backend exchanges code for token and calls SoundCloud API → frontend uses your backend endpoints.**

---

# ✅ Step-by-step fix for a Replit web app

## 1) Create a SoundCloud app + set Redirect URI

In your SoundCloud developer settings:

* Redirect URI: `https://YOUR-REPLIT-APP-URL/callback`

Example:

* `https://myproject.username.repl.co/callback`

This must match exactly.

---

## 2) Add a backend (Express) in Replit

Create `server.js`:

```js
import express from "express";
import fetch from "node-fetch";
import dotenv from "dotenv";

dotenv.config();

const app = express();
app.use(express.json());

const CLIENT_ID = process.env.SOUNDCLOUD_CLIENT_ID;
const CLIENT_SECRET = process.env.SOUNDCLOUD_CLIENT_SECRET;
const BASE_URL = process.env.APP_BASE_URL; // e.g. https://myproject.username.repl.co

function redirectUri() {
  return `${BASE_URL}/callback`;
}

/**
 * 1) Start OAuth: redirect user to SoundCloud login page (THIS is allowed in browser)
 */
app.get("/auth/soundcloud", (req, res) => {
  const url =
    "https://soundcloud.com/connect" +
    `?client_id=${encodeURIComponent(CLIENT_ID)}` +
    `&redirect_uri=${encodeURIComponent(redirectUri())}` +
    `&response_type=code`;

  res.redirect(url);
});

/**
 * 2) OAuth callback: receives ?code=... from SoundCloud
 *    Exchange code -> token on the server (keeps client_secret safe)
 */
app.get("/callback", async (req, res) => {
  const code = req.query.code;
  if (!code) return res.status(400).send("Missing code");

  const body = new URLSearchParams({
    client_id: CLIENT_ID,
    client_secret: CLIENT_SECRET,
    redirect_uri: redirectUri(),
    grant_type: "authorization_code",
    code: String(code),
  });

  const tokenRes = await fetch("https://api.soundcloud.com/oauth2/token", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: body.toString(),
  });

  const tokenJson = await tokenRes.json();
  if (!tokenRes.ok) {
    return res.status(500).send(`Token exchange failed: ${JSON.stringify(tokenJson)}`);
  }

  // For V1: store token in a secure cookie (simple). In production, use sessions/DB.
  // Here we just redirect back to frontend with a short-lived token in URL fragment.
  // Better: set httpOnly cookie and redirect without exposing token to JS.
  const accessToken = tokenJson.access_token;

  // Redirect back to app (frontend) with token in fragment (not sent to server logs)
  res.redirect(`/#/connected#access_token=${encodeURIComponent(accessToken)}`);
});

/**
 * 3) Proxy endpoint: call SoundCloud API from server to avoid CORS
 */
app.get("/api/sc/me", async (req, res) => {
  const token = req.headers.authorization?.replace("Bearer ", "");
  if (!token) return res.status(401).json({ error: "Missing token" });

  const r = await fetch("https://api.soundcloud.com/me", {
    headers: { Authorization: `Bearer ${token}` },
  });

  const j = await r.json();
  res.status(r.status).json(j);
});

/**
 * Search tracks (proxy)
 */
app.get("/api/sc/search", async (req, res) => {
  const token = req.headers.authorization?.replace("Bearer ", "");
  const q = String(req.query.q || "");
  if (!token) return res.status(401).json({ error: "Missing token" });
  if (!q) return res.status(400).json({ error: "Missing q" });

  const url = `https://api.soundcloud.com/tracks?q=${encodeURIComponent(q)}&limit=20`;
  const r = await fetch(url, {
    headers: { Authorization: `Bearer ${token}` },
  });
  const j = await r.json();
  res.status(r.status).json(j);
});

app.get("/health", (_, res) => res.json({ ok: true }));

const port = process.env.PORT || 3000;
app.listen(port, () => console.log("Server running on", port));
```

---

## 3) Add `.env` variables in Replit

In Replit “Secrets” (Environment Variables), add:

* `SOUNDCLOUD_CLIENT_ID` = `...`
* `SOUNDCLOUD_CLIENT_SECRET` = `...`
* `APP_BASE_URL` = `https://YOUR-REPLIT-APP-URL`

---

## 4) Frontend: “Connect SoundCloud” button

In your React UI:

```tsx
export function ConnectSoundCloudButton() {
  const onConnect = () => {
    window.location.href = "/auth/soundcloud";
  };

  return <button onClick={onConnect}>Connect SoundCloud</button>;
}
```

---

## 5) Frontend: read token after redirect

If you used the `/#/connected#access_token=...` trick, read it:

```ts
export function readAccessTokenFromHash(): string | null {
  const hash = window.location.hash; // e.g. "#/connected#access_token=..."
  const idx = hash.indexOf("access_token=");
  if (idx === -1) return null;
  return decodeURIComponent(hash.substring(idx + "access_token=".length).split("&")[0]);
}
```

Then call your proxy endpoints:

```ts
export async function scMe(token: string) {
  const res = await fetch("/api/sc/me", {
    headers: { Authorization: `Bearer ${token}` },
  });
  return res.json();
}

export async function scSearch(token: string, q: string) {
  const res = await fetch(`/api/sc/search?q=${encodeURIComponent(q)}`, {
    headers: { Authorization: `Bearer ${token}` },
  });
  return res.json();
}
```

---

# Why this fixes your exact error

* You **never open** `api.soundcloud.com` as a page (which causes “refused to connect”)
* Browser only opens `soundcloud.com/connect` (allowed)
* All API calls to `api.soundcloud.com` happen from your server (no CORS issue)

---

# Recommended “best practice” upgrade (after V1)

Instead of passing the access token in the URL fragment, use:

* **httpOnly secure cookies** + sessions
* or store tokens in your DB per user

But the above is the fastest path to get you unblocked on Replit.

---

If you tell me whether your Replit project is currently **Vite (single port)** or **separate frontend + backend**, I’ll tailor the exact folder layout and start script so it runs cleanly inside Replit.
